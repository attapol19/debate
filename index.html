<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Debate Timer 1-5-2 </title>
<style>
  :root{ --blue:#0b3b91; --red:#d10000; --orange:#ff8c00; }
  html, body { height: 100%; }
  body{
    margin:0;
    background:#fff;
    font-family: Arial, sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:space-between;
    padding: 3vh 4vw 3vh;
    box-sizing: border-box;
  }

  .title{
    text-align:center;
    margin-top: 0.5vh;
  }
  .title .main{
    font-size: clamp(20px, 3.0vw, 40px);
    font-weight: 900;
    color: var(--blue);
  }
  .title .sub{
    font-size: clamp(13px, 2.0vw, 22px);
    font-weight: 700;
    color: #333;
    margin-top: 4px;
  }

  #timer{
    font-weight: 900;
    letter-spacing: 2px;
    color: var(--blue);
    line-height: 1;
    font-size: clamp(160px, 20vw, 460px);
    user-select:none;
  }
  .big10 #timer{
    color: var(--red);
    font-size: clamp(220px, 28vw, 560px);
  }

.controls button {
  font-size: 18px;
  padding: 8px 18px;
  border-radius: 8px;
  border: 1px solid #cfd8e3;
  background: #f7f9fc;
  color: #1e3a8a;
}

.controls button.primary {
  background: #2563eb;
  color: white;
  border: none;
}

.controls {
  opacity: 0.85;
}

</style>
</head>

<body id="wrap">

  <div class="title">
    <div class="main">ดีเบต ผู้สมัคร ส.ส.ตราด</div>
    <div class="sub">เวทีวิสัยทัศน์เพื่อเศรษฐกิจและอนาคตจังหวัดตราด</div>
  </div>

  <div id="timer">01:00</div>

  <div style="width:100%;">
    <div class="controls">
      <!-- ตั้งเวลา (รีเซ็ตอย่างเดียว ไม่เริ่มเดิน) -->
      <button onclick="setTime(60)">ตั้ง 1 นาที</button>
      <button onclick="setTime(300)">ตั้ง 5 นาที</button>
      <button onclick="setTime(120)">ตั้ง 2 นาที</button>

      <!-- ควบคุม -->
      <button class="primary" onclick="start()">เริ่ม</button>
      <button class="secondary" onclick="pause()">หยุด</button>
      <button class="secondary" onclick="reset()">รีเซ็ต</button>
    </div>
  </div>

<script>
let total = 60;
let interval = null;
let warned30 = false;
let selected = 60;
let running = false;

const el = document.getElementById("timer");

// ---- Web Audio (ไม่ต้องใช้ mp3) ----
let audioCtx = null;
function ensureAudio(){
  if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  if(audioCtx.state === "suspended") audioCtx.resume();
}
function beep(freq=900, duration=0.12, gain=0.25, type="square"){
  try{
    ensureAudio();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type;
    o.frequency.value = freq;
    g.gain.value = gain;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    o.stop(audioCtx.currentTime + duration);
  }catch(e){}
}
// เตือน 30 วิ (ครั้งเดียว)
function warnBeep30(){
  beep(880, 0.18, 0.22, "square");
}
// ออดหมดเวลา (ยาวแบบออดเลิกเรียน)
function endBuzz(){
  beep(180, 0.6, 0.40, "square");
  setTimeout(() => beep(180, 0.6, 0.40, "square"), 650);
  setTimeout(() => beep(180, 0.9, 0.45, "square"), 1300);
}

function fmt(t){
  const m = Math.floor(t/60);
  const s = t%60;
  return String(m).padStart(2,'0') + ":" + String(s).padStart(2,'0');
}

function render() {
  el.textContent = fmt(total);

  // สีแดงเมื่อใกล้หมดเวลา (ไม่มีเสียง 10 วิแล้วตามที่ขอ)
  if (total <= 10) el.style.color = "#d32f2f";
  else el.style.color = "#0d47a1";
}

function setTime(sec) {
  clearInterval(interval);
  running = false;
  selected = sec;
  total = sec;
  warned30 = false;
  render();
}

function start() {
  // iOS ต้องมีการแตะปุ่มเพื่อปลดล็อกเสียง -> เรียก ensureAudio ใน start
  ensureAudio();

  if(running) return;
  running = true;

  clearInterval(interval);
  interval = setInterval(() => {
    // เตือน 30 วินาที ครั้งเดียว ทุกโหมด
    if (total === 30 && !warned30) {
      warned30 = true;
      warnBeep30();
    }

    render();

    if (total > 0) {
      total--;
    } else {
      clearInterval(interval);
      running = false;
      endBuzz();
    }
  }, 1000);
}

function pause() {
  clearInterval(interval);
  running = false;
}

function reset() {
  setTime(selected); // reset กลับไปเวลาที่เลือกไว้ล่าสุด (ไม่เริ่ม)
}

// เรียกครั้งแรก
render();
</script>





</body>
</html>





