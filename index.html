<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Debate Timer 1-5-2 </title>
<style>
  :root{ --blue:#0b3b91; --red:#d10000; --orange:#ff8c00; }
  html, body { height: 100%; }
  body{
    margin:0;
    background:#fff;
    font-family: Arial, sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:space-between;
    padding: 3vh 4vw 3vh;
    box-sizing: border-box;
  }

  .title{
    text-align:center;
    margin-top: 0.5vh;
  }
  .title .main{
    font-size: clamp(20px, 3.0vw, 40px);
    font-weight: 900;
    color: var(--blue);
  }
  .title .sub{
    font-size: clamp(13px, 2.0vw, 22px);
    font-weight: 700;
    color: #333;
    margin-top: 4px;
  }

  #timer{
    font-weight: 900;
    letter-spacing: 2px;
    color: var(--blue);
    line-height: 1;
    font-size: clamp(160px, 20vw, 460px);
    user-select:none;
  }
  .big10 #timer{
    color: var(--red);
    font-size: clamp(220px, 28vw, 560px);
  }

.controls button {
  font-size: 18px;
  padding: 8px 18px;
  border-radius: 8px;
  border: 1px solid #cfd8e3;
  background: #f7f9fc;
  color: #1e3a8a;
}

.controls button.primary {
  background: #2563eb;
  color: white;
  border: none;
}

.controls {
  opacity: 0.85;
}

</style>
</head>

<body id="wrap">

  <div class="title">
    <div class="main">ดีเบต ผู้สมัคร ส.ส.ตราด</div>
    <div class="sub">เวทีวิสัยทัศน์เพื่อเศรษฐกิจและอนาคตจังหวัดตราด</div>
  </div>

  <div id="timer">01:00</div>

  <div style="width:100%;">
    <div class="controls">
      <!-- ตั้งเวลา (รีเซ็ตอย่างเดียว ไม่เริ่มเดิน) -->
      <button onclick="setTime(60)">ตั้ง 1 นาที</button>
      <button onclick="setTime(300)">ตั้ง 5 นาที</button>
      <button onclick="setTime(120)">ตั้ง 2 นาที</button>

      <!-- ควบคุม -->
      <button class="primary" onclick="startOrResume()">เริ่ม</button>
      <button class="secondary" onclick="pauseTimer()">หยุด</button>
      <button class="secondary" onclick="resetTimer()">รีเซ็ต</button>
    </div>
  </div>

<script>
let total = 60;          // เวลาที่เหลือ (วิ)
let selected = 60;       // เวลาที่เลือกไว้ล่าสุด (วิ) สำหรับรีเซ็ต
let interval = null;
let running = false;

const wrap = document.getElementById("wrap");
const el = document.getElementById("timer");

let audioCtx = null;
function ensureAudio(){
  try{
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if(audioCtx.state === "suspended") audioCtx.resume();
  }catch(e){}
}
function beep(freq, duration, gain){
  try{
    ensureAudio();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = "square";          // ดัง ทะลุลำโพง
    o.frequency.value = freq;
    g.gain.value = gain;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    o.stop(audioCtx.currentTime + duration);
  }catch(e){}
}
function tickBeep(){ beep(1200, 0.07, 0.10); }   // ติ๊ด 10 วิสุดท้าย
function endBuzz(){                               // ออดเลิกเรียน (ยาว)
  beep(180, 0.6, 0.40);
  setTimeout(() => beep(180, 0.6, 0.40), 650);
  setTimeout(() => beep(180, 0.9, 0.45), 1300);
}

function fmt(t){
  const m = Math.floor(t/60);
  const s = t%60;
  return String(m).padStart(2,'0') + ":" + String(s).padStart(2,'0');
}

function render(){
  // โหมด 10 วิสุดท้าย
  if(total <= 10 && total > 0){
    wrap.classList.add("big10");
    el.textContent = String(total);
  }else{
    wrap.classList.remove("big10");
    el.textContent = fmt(total);
  }
}

function stopInterval(){
  if(interval){
    clearInterval(interval);
    interval = null;
  }
}

function setTime(sec){
  stopInterval();
  running = false;
  selected = sec;
  total = sec;
  el.style.color = "";          // คืนค่าให้ render จัดการ
  render();
  // ไม่เริ่มเดิน
}

function startOrResume(){
  ensureAudio(); // สำคัญสำหรับมือถือ ให้เสียงทำงาน
  if(running) return; // ถ้ากำลังเดินอยู่ ไม่ต้องทำอะไร

  running = true;

  // เริ่ม interval เดิน
  stopInterval();
  interval = setInterval(() => {
    // เตือน 1 นาที เฉพาะเมื่อ selected = 5 นาที
    if(selected === 300 && total === 60){
      // เปลี่ยนสีส้มชั่วคราว + beep สั้น
      el.style.color = "var(--orange)";
      beep(800, 0.15, 0.25);
      // หลังจากนั้น render จะคุมสีต่อเอง (ยกเว้น 10 วิสุดท้าย)
      setTimeout(() => { el.style.color = ""; render(); }, 300);
    }

    // 10 วิสุดท้าย: ติ๊ดทุกวินาที
    if(total <= 10 && total > 0){
      tickBeep();
    }

    render();

    if(total > 0){
      total--;
    }else{
      // หมดเวลา
      stopInterval();
      running = false;
      endBuzz();
    }
  }, 1000);
}

function pauseTimer(){
  if(!running) return;
  stopInterval();
  running = false;
}

function resetTimer(){
  // รีเซ็ตกลับไปค่า selected (ไม่เริ่มเดิน)
  setTime(selected);
}

/* คีย์ลัดบนคอม (เผื่อทีมเทคนิคชอบใช้) */
document.addEventListener("keydown", (e) => {
  if(e.key === "1") setTime(60);
  if(e.key === "5") setTime(300);
  if(e.key === "2") setTime(120);
  if(e.key === "Enter") startOrResume(); // เริ่ม
  if(e.code === "Space") pauseTimer();   // หยุด
  if(e.key === "r" || e.key === "R") resetTimer();
});

render();
</script>

</body>
</html>


